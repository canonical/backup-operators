# Copyright 2025 Canonical Ltd.
# See LICENSE file for licensing details.
# This file configures Charmcraft.
# See https://canonical-charmcraft.readthedocs-hosted.com/stable/howto/manage-charmcraft/ 
# for guidance.

type: charm
subordinate: true
name: backup-integrator
title: Backup integrator
summary: A integrator charm to declare backup sources.
links:
  documentation: https://discourse.charmhub.io
  issues: https://github.com/canonical/is-charms-template-repo/issues
  source: https://github.com/canonical/is-charms-template-repo
  contact: https://launchpad.net/~canonical-is-devops

description: |
  A single sentence that says what the charm is, concisely and memorably.

  A paragraph of one to three short sentences, that describe what the charm does.

  A third paragraph that explains what need the charm meets.

  Finally, a paragraph that describes whom the charm is useful for.

requires:
  backup:
    interface: backup
  juju-info:
    interface: juju-info
    scope: container

platforms:
  ubuntu@22.04:amd64:
  ubuntu@24.04:amd64:

config:
  options:
    fileset:
      description: >
        A comma-separated list of files to be backed up. Paths must be absolute.
      type: string
    run-before-backup:
      description: >
        The content of a script to run before starting the backup operation.
        If this script fails, the backup operation will be canceled.
        You should include a shebang in your script.
      type: string
    run-after-backup:
      description: >
        The content of a script to run after completing the backup operation.
        This script will still run even if the backup operation fails.
        You should include a shebang in your script.
      type: string
    run-before-restore:
      description: >
        The content of a script to run before starting the restore operation.
        If this script fails, the restore operation will be canceled.
        You should include a shebang in your script.
      type: string
    run-after-restore:
      description: >
        The content of a script to run after completing the restore operation.
        This script will still run even if the restore operation fails.
        You should include a shebang in your script.
      type: string

parts:
  charm:
    build-snaps:
      - rustup
    override-build: |
      rustup default stable
      craftctl default
    build-packages:
      - libffi-dev
      - libssl-dev
      - pkg-config
